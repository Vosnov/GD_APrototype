[gd_scene load_steps=6 format=3 uid="uid://b2uh3a51dh3xl"]

[ext_resource type="PackedScene" uid="uid://deesr7gvdxugc" path="res://Maps/map_room.tscn" id="1_3w1i8"]
[ext_resource type="Texture2D" uid="uid://bc0wd7e2kwdmm" path="res://icon.svg" id="2_g64x0"]
[ext_resource type="PackedScene" uid="uid://lch86o4fih33" path="res://Maps/map_door.tscn" id="4_fkv2a"]

[sub_resource type="GDScript" id="GDScript_5x8xw"]
script/source = "extends Node2D

@onready var player_sprite = $PlayerSprite

var player: Node3D
var room_config: RoomConfig
var map_room_center = Vector2()

func _ready():
	player = get_tree().get_first_node_in_group('player')
	room_config = get_tree().get_first_node_in_group('room_config')
	
	if player == null:
		printerr('Player not found')
		return
	
	if room_config == null:
		printerr('Room config not found')
		return
	
	for child in get_children():
		if child is MapRoom:
			if room_config.get_scene_path() == child.SCENE_PATH:
				map_room_center = child.get_center_pos()
				break

	set_player_sprite_pos()
	global_position += (DisplayServer.window_get_size() / 2.0) - player_sprite.global_position 


func set_player_sprite_pos():
	if player == null: return
	if room_config == null: return
	
	var new_player_pos = player.global_position - room_config.get_center_pos()
	var player_pos = Vector2(new_player_pos.x, new_player_pos.z)
	player_pos = player_pos * 32 / 2
	
	player_sprite.global_position = player_pos + map_room_center
"

[sub_resource type="GDScript" id="GDScript_85a21"]
script/source = "extends Camera2D

func _physics_process(delta):
	var input_dir = Input.get_vector(\"left\", \"right\", \"top\", \"bottom\")
	position += input_dir * delta * 2000
	
func _input(_event):
	if Input.is_action_just_pressed('shot'):
		var new_zoom = zoom + Vector2(0.5, 0.5)
		zoom = clamp(new_zoom, Vector2(0.5, 0.5), Vector2(3, 3))
	if Input.is_action_just_pressed('aim'):
		var new_zoom = zoom - Vector2(0.5, 0.5)
		zoom = clamp(new_zoom, Vector2(0.5, 0.5), Vector2(3, 3))
	
"

[node name="TestMap" type="Node2D"]
script = SubResource("GDScript_5x8xw")

[node name="MainRoom" parent="." instance=ExtResource("1_3w1i8")]
SCENE_PATH = "res://Scenes/test_scene.tscn"

[node name="Center" parent="MainRoom" index="0"]
position = Vector2(144, 592)

[node name="TileMap" parent="MainRoom" index="1"]
layer_0/tile_data = PackedInt32Array(589824, 0, 3, 589825, 65536, 3, 589826, 65536, 3, 589827, 524288, 0, 589828, 65536, 3, 589829, 65536, 3, 589830, 65536, 3, 589831, 65536, 3, 589832, 131072, 3, 655363, 196608, 1, 720899, 196608, 1, 786435, 196608, 1, 851971, 196608, 1, 917507, 196608, 1, 983043, 196608, 1, 1048579, 196608, 1, 1114115, 262144, 2, 1114116, 65536, 0, 1114117, 131072, 0, 1179653, 131072, 1, 1245189, 131072, 2, 1245188, 65536, 2, 1245187, 0, 2, 1179651, 0, 1, 1179652, 65536, 1)

[node name="Room1" parent="MainRoom" instance=ExtResource("4_fkv2a")]
position = Vector2(128, 496)
rotation = 1.57079
NAME = "Room1"
STATE = 3

[node name="Room2" parent="MainRoom" instance=ExtResource("4_fkv2a")]
position = Vector2(128, 384)
rotation = 1.57079
NAME = "Room2"
STATE = 3

[node name="SaveRoom" parent="MainRoom" instance=ExtResource("4_fkv2a")]
position = Vector2(288, 304)
rotation = 1.57079
NAME = "SaveRoom"
STATE = 3

[node name="Room3" parent="MainRoom" instance=ExtResource("4_fkv2a")]
position = Vector2(224, 288)
NAME = "Room3"
STATE = 3

[node name="Room1" parent="." instance=ExtResource("1_3w1i8")]
SCENE_PATH = "res://Scenes/room_1.tscn"

[node name="Center" parent="Room1" index="0"]
position = Vector2(176, 496)

[node name="TileMap" parent="Room1" index="1"]
layer_0/tile_data = PackedInt32Array(1048580, 0, 2, 1048581, 65536, 2, 1048582, 131072, 2, 983046, 131072, 1, 917510, 131072, 0, 917509, 65536, 0, 917508, 0, 0, 983044, 0, 1, 983045, 65536, 1)

[node name="Room2" parent="." instance=ExtResource("1_3w1i8")]
SCENE_PATH = "res://Scenes/room_2.tscn"

[node name="Center" parent="Room2" index="0"]
position = Vector2(160, 384)

[node name="TileMap" parent="Room2" index="1"]
layer_0/tile_data = PackedInt32Array(655364, 0, 0, 720900, 0, 1, 786436, 0, 1, 851972, 0, 2, 851973, 65536, 2, 851974, 65536, 2, 851975, 65536, 2, 851976, 131072, 2, 786440, 131072, 1, 720904, 131072, 1, 655368, 131072, 0, 655367, 65536, 0, 655366, 65536, 0, 655365, 65536, 0, 720901, 65536, 1, 786437, 65536, 1, 786438, 65536, 1, 786439, 65536, 1, 720903, 65536, 1, 720902, 65536, 1)

[node name="SaveRoom" parent="." instance=ExtResource("1_3w1i8")]
SCENE_PATH = "res://Scenes/save_room.tscn"

[node name="Center" parent="SaveRoom" index="0"]
position = Vector2(336, 304)

[node name="TileMap" parent="SaveRoom" index="1"]
layer_0/tile_data = PackedInt32Array(524297, 0, 0, 589833, 0, 1, 655369, 0, 2, 655370, 65536, 2, 655371, 131072, 2, 589835, 131072, 1, 524299, 131072, 0, 524298, 65536, 0, 589834, 65536, 1)

[node name="Room3" parent="." instance=ExtResource("1_3w1i8")]
SCENE_PATH = "res://Scenes/room_3.tscn"

[node name="Center" parent="Room3" index="0"]
position = Vector2(224, 256)

[node name="TileMap" parent="Room3" index="1"]
layer_0/tile_data = PackedInt32Array(524294, 0, 2, 524295, 131072, 2, 458759, 131072, 1, 393223, 131072, 1, 327687, 131072, 1, 262151, 131072, 1, 262150, 0, 1, 327686, 0, 1, 393222, 0, 1, 458758, 0, 1, 196613, 0, 2, 196614, 393216, 1, 196615, 327680, 1, 196616, 65536, 2, 196617, 131072, 2, 131081, 131072, 1, 65545, 131072, 1, 9, 131072, 0, 8, 65536, 0, 7, 65536, 0, 6, 65536, 0, 5, 0, 0, 65541, 0, 1, 131077, 0, 1, 131078, 65536, 1, 131079, 65536, 1, 131080, 65536, 1, 65544, 65536, 1, 65543, 65536, 1, 65542, 65536, 1)

[node name="PlayerSprite" type="Sprite2D" parent="."]
z_index = 2
position = Vector2(224, 256)
scale = Vector2(0.1, 0.1)
texture = ExtResource("2_g64x0")

[node name="Camera2D" type="Camera2D" parent="PlayerSprite"]
script = SubResource("GDScript_85a21")

[editable path="MainRoom"]
[editable path="Room1"]
[editable path="Room2"]
[editable path="SaveRoom"]
[editable path="Room3"]
