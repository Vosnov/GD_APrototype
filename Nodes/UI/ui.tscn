[gd_scene load_steps=6 format=3 uid="uid://en3g0v7xjkgn"]

[ext_resource type="PackedScene" uid="uid://dwhdypbxa1gl7" path="res://Nodes/UI/inventory_ui.tscn" id="1_vjmbd"]
[ext_resource type="PackedScene" uid="uid://bdvj6pfhtgs1e" path="res://Nodes/UI/dead_screen.tscn" id="2_e8xum"]
[ext_resource type="PackedScene" uid="uid://drr3ddmpotjgj" path="res://Nodes/UI/message_ui.tscn" id="3_138rf"]

[sub_resource type="GDScript" id="GDScript_tkxjl"]
script/source = "extends CanvasLayer

@export var INVENTORY_UI: PackedScene
@export var DEAD_SCREEN: PackedScene

@onready var reload_label = $ReloadData
@onready var hp_label = $HP

var inventory_instance: Node
var dead_screen_instance: Node

func _ready():
	Events.connect(\"player_dead\", _on_player_dead)
	Events.connect(\"player_reload_data_ui\", _on_reload_data)
	Events.connect(\"player_hp_ui\", _on_player_hp_ui)

func close_inventory():
	get_tree().paused = false
	if inventory_instance != null: inventory_instance.queue_free()

func _on_reload_data(amount: int, total_amount: int):
	reload_label.text = str(\"Load amount: \", amount, \" Total amount: \", total_amount)

func _on_player_hp_ui(_hp: float):
	hp_label.text = str('HP: ', _hp)

func _input(_event):
	if dead_screen_instance != null: return
	if Input.is_action_just_pressed('ui_menu') and inventory_instance == null:
		inventory_instance = INVENTORY_UI.instantiate()
		add_child(inventory_instance)
		get_tree().paused = true
	if Input.is_action_just_pressed('ui_cancel'):
		close_inventory()

func _on_player_dead():
	close_inventory()
	dead_screen_instance = DEAD_SCREEN.instantiate()
	add_child(dead_screen_instance)
	get_tree().paused = true

func _exit_tree():
	get_tree().paused = false
"

[sub_resource type="GDScript" id="GDScript_py8tj"]
script/source = "extends Node

@export var MESSAGE_UI: PackedScene

@onready var destroy_block_timer = $DestroyBlockTimer
@onready var close_timer = $CloseTimer

var message_ui: MessageUI
var can_destory = false
var remove_message_ui_inputs = [\"action\", \"ui_cancel\", \"ui_menu\", \"shot\", \"aim\"]
var message = ''

func _ready():
	Events.connect(\"message_ui\", _on_message)
	
func _on_message(_message: String):
	if message_ui != null:
		return
	
	message = _message
	can_destory = false
	destroy_block_timer.start(destroy_block_timer.wait_time)

	message_ui = MESSAGE_UI.instantiate() as MessageUI
	add_child(message_ui)
	message_ui.set_message(message)

func _input(_event):
	if message_ui == null or can_destory == false: return
	for action_name in remove_message_ui_inputs:
		var is_pressed = Input.is_action_just_pressed(action_name)
		if is_pressed:
			remove_message_ui()
			return

func remove_message_ui():
	close_timer.start(close_timer.wait_time)

func _on_destroy_block_timer_timeout():
	can_destory = true

func _on_close_timer_timeout():
	message_ui.queue_free()
	Events.emit_signal(\"message_close_ui\", message)
"

[node name="UI" type="CanvasLayer"]
process_mode = 3
script = SubResource("GDScript_tkxjl")
INVENTORY_UI = ExtResource("1_vjmbd")
DEAD_SCREEN = ExtResource("2_e8xum")

[node name="ReloadData" type="Label" parent="."]
offset_right = 40.0
offset_bottom = 23.0

[node name="HP" type="Label" parent="."]
offset_top = 40.0
offset_right = 40.0
offset_bottom = 63.0

[node name="MessageContainer" type="Node" parent="."]
script = SubResource("GDScript_py8tj")
MESSAGE_UI = ExtResource("3_138rf")

[node name="DestroyBlockTimer" type="Timer" parent="MessageContainer"]
wait_time = 0.2
one_shot = true

[node name="CloseTimer" type="Timer" parent="MessageContainer"]
wait_time = 0.2
one_shot = true

[connection signal="timeout" from="MessageContainer/DestroyBlockTimer" to="MessageContainer" method="_on_destroy_block_timer_timeout"]
[connection signal="timeout" from="MessageContainer/CloseTimer" to="MessageContainer" method="_on_close_timer_timeout"]
