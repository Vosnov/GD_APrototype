[gd_scene load_steps=4 format=3 uid="uid://5t4rmu1n0533"]

[ext_resource type="PackedScene" uid="uid://dwhdypbxa1gl7" path="res://Nodes/UI/inventory_ui.tscn" id="1_cy3mg"]

[sub_resource type="GDScript" id="GDScript_bkayh"]
script/source = "extends TabContainer

func _ready():
	GlobalVariables.menu_ui_is_open = true
	get_tree().paused = true
	Input.mouse_mode = Input.MOUSE_MODE_VISIBLE

func _exit_tree():
	Input.mouse_mode = Input.MOUSE_MODE_CAPTURED
	get_tree().paused = false
	GlobalVariables.menu_ui_is_open = false

func _input(_event):
	if Input.is_action_just_pressed('ui_cancel') or Input.is_action_just_pressed('ui_menu'):
		queue_free()
"

[sub_resource type="GDScript" id="GDScript_h4ou5"]
script/source = "extends SubViewport

var current_floor_index = 0:
	set(value):
		var max_floors = room_config.FLOOR_MAPS_DATA.FLOORS.size()
		current_floor_index = clamp(value, 0, max_floors)

var room_config: RoomConfig
var floor_instance: Node

func _ready():
	room_config = get_tree().get_first_node_in_group('room_config') as RoomConfig
	
	if room_config == null:
		printerr('Room config not found')
		return
	
	current_floor_index = room_config.CURRENT_FLOOR_INDEX
	show_floor(current_floor_index)

func _input(_event):
	if Input.is_action_just_pressed('gun_0'):
		current_floor_index -= 1
		show_floor(current_floor_index)
	if Input.is_action_just_pressed(\"gun_1\"):
		current_floor_index += 1
		show_floor(current_floor_index)

func show_floor(index: int):
	if floor_instance != null:
		floor_instance.queue_free()
	
	floor_instance = room_config.FLOOR_MAPS_DATA.FLOORS[index].instantiate()
	add_child(floor_instance)
"

[node name="PlayerMenu" type="TabContainer"]
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
tab_alignment = 1
script = SubResource("GDScript_bkayh")

[node name="Map" type="Control" parent="."]
layout_mode = 2

[node name="SubViewportContainer" type="SubViewportContainer" parent="Map"]
layout_mode = 1
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
stretch = true

[node name="SubViewport" type="SubViewport" parent="Map/SubViewportContainer"]
disable_3d = true
transparent_bg = true
handle_input_locally = false
canvas_item_default_texture_filter = 0
size = Vector2i(1280, 689)
render_target_update_mode = 4
script = SubResource("GDScript_h4ou5")

[node name="InventoryUI" parent="." instance=ExtResource("1_cy3mg")]
visible = false
layout_mode = 2
